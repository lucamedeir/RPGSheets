<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>RPG Sheets</title>
		<script src="https://unpkg.com/react@15/dist/react.js"></script>
		<script src="https://unpkg.com/react-dom@15/dist/react-dom.js"></script>
		<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
		<script src="http://localhost:8080/public/javascript/fetch-2.0.1.js"></script>
	</head>

	<body>
		<div id="root"></div>
		<script type="text/babel">


			class WorldList extends React.Component {
				constructor(props) {
					super(props);
				}

				render () {
					return (
						<ul>
							{this.props.worlds.map(world=>(
								<li key={world.name}>
									<a href="" ><img alt={"delete_"+world.name} src="/public/images/delete.png" width="15" height="15" /></a>
									<a href={world.url} target="_top">{world.name}</a>
									
								</li>
							))}
						</ul>
					);
				}
			}

			class Main extends React.Component {
				constructor(props) {
					super (props);
					

					this.handleSubmit = this.handleSubmit.bind(this);
					this.handleChange = this.handleChange.bind(this);

					this.state = {worlds:[], form:{name:''}};
				}

				componentDidMount() {
					fetch('/api/world').then((response)=>{
						return response.json();
					}).then((json)=>{
						console.log(json);
						this.setState({worlds:json.map((world)=>({
							name:world.name,
							url:"/"+world.name
						}))});
					});
				}

				handleSubmit(e) {
					e.preventDefault();
					console.log(this);
					if(this.state.form.name) {
						fetch('/api/world', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify({
								post:{name: this.state.form.name}
							})
						}).then((response) =>{
							if(response.status == 201) {
								var newWorld = {
									name:this.state.form.name,
									url: "/"+this.state.form.name
									};
								this.setState((prevState)=>({
									worlds: prevState.worlds.concat(newWorld),
									form:{name:''}
								}));
							}
						});
					}

				}

				handleChange(e) {
					this.setState({form:{name:e.target.value}});
				}

				render () {
					return (
						<div>
							<WorldList worlds={this.state.worlds} />
							<form onSubmit={this.handleSubmit}>
								<input onChange={this.handleChange} value={this.state.form.name} />
								<button>Add World</button>
							</form>
						</div>
					);
				}
			}

			ReactDOM.render(
			  <Main />,
			  document.getElementById('root')
			);
		</script>
	</body>

</html>